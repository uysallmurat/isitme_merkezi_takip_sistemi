 <!-- Base Body ImportlarÄ± -->
{% include 'frontend/partials/base/body.html' %}
 
   <!-- Progress Bar -->
   <div class="progress-bar" id="progressBar"></div>
    
   <!-- Toast Container -->
   <div class="toast-container" id="toastContainer"></div>
   
   <!-- Page Transition -->
   <div class="page-transition" id="pageTransition">
       <div class="page-transition-content">
           <div class="page-transition-spinner"></div>
           <div class="page-transition-text">YÃ¼kleniyor...</div>
       </div>
   </div>
   
   <!-- Confirmation Modal -->
   <div class="confirmation-overlay" id="confirmationOverlay">
       <div class="confirmation-modal">
           <div class="confirmation-icon" id="confirmationIcon">
               <i class="fa-solid fa-exclamation-triangle"></i>
           </div>
           <div class="confirmation-title" id="confirmationTitle">Emin misiniz?</div>
           <div class="confirmation-message" id="confirmationMessage">Bu iÅŸlem geri alÄ±namaz.</div>
           <div class="confirmation-actions">
               <button class="btn-cancel" id="confirmationCancel">Ä°ptal</button>
               <button class="btn-confirm" id="confirmationConfirm">Onayla</button>
           </div>
       </div>
   </div>
   <div class="topbar">
       <div class="logo">MAVÄ° Ä°ÅžÄ°TME MERKEZÄ°</div>
       <nav>
           <a href="/logout/" class="logout-link nav-link" onclick="confirmLogout(event)">
               <i class="fa-solid fa-right-from-bracket"></i>
                Ã‡IKIÅž 
           </a>
       </nav>
   </div>
   <div class="page-container">
       <aside class="sidebar">
           <div class="sidebar-logo">
               <span class="sidebar-logo-icon">ðŸŽ§</span>
               <div class="sidebar-logo-text">Hasta Takip Sistemi</div>
           </div>
           <ul>
               <li><a href="/dashboard/" class="nav-link nav-item" data-route="/dashboard"><i class="fa-solid fa-house home-icon"></i> ANASAYFA</a></li>
               <li><a href="/patients/" class="nav-link nav-item active" data-route="/patients"><i class="fa-solid fa-user-injured"></i> HASTALAR</a></li>
               <li><a href="/appointments/" class="nav-link nav-item" data-route="/appointments"><i class="fa-solid fa-calendar-check"></i> RANDEVULAR</a></li>
               <li><a href="/devices/" class="nav-link nav-item" data-route="/devices"><i class="fa-solid fa-headset"></i> CÄ°HAZLAR</a></li>
               <li><a href="/test-reports/" class="nav-link nav-item" data-route="/tests"><i class="fa-solid fa-file-medical"></i> TEST RAPORLARI</a></li>
               <li><a href="/inventory/" class="nav-link nav-item" data-route="/inventory"><i class="fa-solid fa-boxes-stacked"></i> STOK YÃ–NETÄ°MÄ°</a></li>
               <li><a href="/invoices/" class="nav-link nav-item" data-route="/invoices"><i class="fa-solid fa-file-invoice-dollar"></i> FATURA YÃ–NETÄ°MÄ°</a></li>
           </ul>
       </aside>
       <main class="main-content">
           <div class="page-header">
               <div class="title-section">
                   <h1 class="page-title">
                       <i class="fa-solid fa-user-injured"></i>
                       Hasta YÃ¶netimi
                   </h1>
               </div>
               <div class="main-search-container">
                   <div class="filter-group">
                       <input type="text" id="mainSearch" placeholder="Ad, soyad, telefon veya email ile ara..." onkeyup="applyFilters()">
                   </div>
               </div>
               <div class="header-buttons">
                   <button type="button" class="clear-filters-btn" onclick="clearAllFilters()">
                       <i class="fa-solid fa-filter-circle-xmark"></i>
                       Filtreleri Temizle
                   </button>
                   <button type="button" class="btn-primary" onclick="openNewPatientModal()">
                       <i class="fa-solid fa-plus"></i>
                       Yeni Hasta
                   </button>
               </div>
           </div>
           

           
           <div class="stats-cards">
               <div class="stat-card">
                   <div class="stat-icon">
                       <i class="fa-solid fa-users"></i>
                   </div>
                   <div class="stat-content">
                       <div class="stat-number" id="totalPatients">0</div>
                       <div class="stat-label">Toplam Hasta</div>
                   </div>
               </div>
               <div class="stat-card">
                   <div class="stat-icon">
                       <i class="fa-solid fa-user-check"></i>
                   </div>
                   <div class="stat-content">
                       <div class="stat-number" id="activePatients">0</div>
                       <div class="stat-label">Aktif Hastalar</div>
                   </div>
               </div>
               <div class="stat-card">
                   <div class="stat-icon">
                       <i class="fa-solid fa-user-plus"></i>
                   </div>
                   <div class="stat-content">
                       <div class="stat-number" id="newPatients">0</div>
                       <div class="stat-label">Bu Ay Yeni Hasta</div>
                   </div>
               </div>
               <div class="stat-card">
                   <div class="stat-icon">
                       <i class="fa-solid fa-calendar-check"></i>
                   </div>
                   <div class="stat-content">
                       <div class="stat-number" id="appointmentsThisMonth">0</div>
                       <div class="stat-label">Bu Ay Randevu</div>
                   </div>
               </div>
           </div>
           
           <div class="content-card">
               <div class="table-container">
                   <table>
                       <thead>
                           <tr>
                               <th class="sortable-header" onclick="toggleFilter('tcNumber')">
                                   <i class="fa-solid fa-id-card"></i>
                                   TC Kimlik No 
                                   <i class="fa-solid fa-filter"></i>
                                   <div class="filter-dropdown" id="tcNumber-filter">
                                       <input type="text" placeholder="TC no ara..." onkeyup="filterByTcNumber(this.value)">
                                   </div>
                               </th>
                               <th class="sortable-header" onclick="toggleFilter('name')">
                                   <i class="fa-solid fa-user"></i>
                                   Ad Soyad 
                                   <i class="fa-solid fa-filter"></i>
                                   <div class="filter-dropdown" id="name-filter">
                                       <input type="text" placeholder="Ad soyad ara..." onkeyup="filterByName(this.value)">
                                       <div class="filter-options" id="name-options"></div>
                                   </div>
                               </th>
                               <th class="sortable-header" onclick="toggleFilter('birthDate')">
                                   <i class="fa-solid fa-calendar-day"></i>
                                   DoÄŸum Tarihi 
                                   <i class="fa-solid fa-filter"></i>
                                   <div class="filter-dropdown" id="birthDate-filter">
                                       <div class="date-range-filter">
                                           <input type="date" id="birthDate-start" placeholder="BaÅŸlangÄ±Ã§" onchange="filterByBirthDate()">
                                           <input type="date" id="birthDate-end" placeholder="BitiÅŸ" onchange="filterByBirthDate()">
                                       </div>
                                   </div>
                               </th>
                               <th class="sortable-header" onclick="toggleFilter('phone')">
                                   <i class="fa-solid fa-phone"></i>
                                   Telefon 
                                   <i class="fa-solid fa-filter"></i>
                                   <div class="filter-dropdown" id="phone-filter">
                                       <input type="text" placeholder="Telefon ara..." onkeyup="filterByPhone(this.value)">
                                   </div>
                               </th>
                               <th class="sortable-header" onclick="toggleFilter('email')">
                                   <i class="fa-solid fa-envelope"></i>
                                   E-posta 
                                   <i class="fa-solid fa-filter"></i>
                                   <div class="filter-dropdown" id="email-filter">
                                       <input type="text" placeholder="E-posta ara..." onkeyup="filterByPhone(this.value)">
                                   </div>
                               </th>
                               <th class="sortable-header" onclick="toggleFilter('lastAppointment')">
                                   <i class="fa-solid fa-calendar-check"></i>
                                   Son Randevu 
                                   <i class="fa-solid fa-filter"></i>
                                   <div class="filter-dropdown" id="lastAppointment-filter">
                                       <div class="date-range-filter">
                                           <input type="date" id="lastAppointment-start" placeholder="BaÅŸlangÄ±Ã§">
                                           <input type="date" id="lastAppointment-end" placeholder="BitiÅŸ">
                                       </div>
                                   </div>
                               </th>
                               <th class="sortable-header" onclick="toggleFilter('status')">
                                   <i class="fa-solid fa-toggle-on"></i>
                                   Durum 
                                   <i class="fa-solid fa-filter"></i>
                                   <div class="filter-dropdown" id="status-filter">
                                       <select onchange="filterByStatus(this.value)">
                                           <option value="">TÃ¼mÃ¼</option>
                                           <option value="active">Aktif</option>
                                           <option value="inactive">Pasif</option>
                                       </select>
                                   </div>
                               </th>
                               <th>
                                   <i class="fa-solid fa-cogs"></i>
                                   Ä°ÅŸlemler
                               </th>
                           </tr>
                       </thead>
                       <tbody id="patientsTable">
                           <tr>
                               <td colspan="8" style="text-align: center; padding: 2rem;">
                                   <i class="fa-solid fa-spinner fa-spin"></i> YÃ¼kleniyor...
                               </td>
                           </tr>
                       </tbody>
                   </table>
               </div>
               
               <!-- Pagination -->
               <div class="pagination-container">
                   <div id="pagination" class="pagination"></div>
               </div>
                        </div>
        </main>
    </div>

   <!-- Yeni Hasta Ekleme Modal -->
   <div id="newPatientModal" class="modal" style="display: none;">
       <div class="modal-content">
           <div class="modal-header">
               <h2>
                   <i class="fa-solid fa-user-plus"></i>
                   Yeni Hasta Ekle
               </h2>
               <span class="close" onclick="closeNewPatientModal()">&times;</span>
           </div>
           <div class="modal-body">
                                <form id="newPatientForm">
                    {% csrf_token %}
                    
                    <!-- Temel Bilgiler -->
                    <div class="form-section">
                        <h3 class="section-title">Temel Bilgiler</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tcNumber">TC Kimlik No <span class="required">*</span></label>
                                <input type="text" id="tcNumber" name="tc_number" maxlength="11" required>
                            </div>
                            <div class="form-group">
                                <label for="firstName">Ad <span class="required">*</span></label>
                                <input type="text" id="firstName" name="first_name" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lastName">Soyad <span class="required">*</span></label>
                                <input type="text" id="lastName" name="last_name" required>
                            </div>
                            <div class="form-group">
                                <label for="birthDate">DoÄŸum Tarihi <span class="required">*</span></label>
                                <input type="date" id="birthDate" name="birth_date" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gender">Cinsiyet <span class="required">*</span></label>
                                <select id="gender" name="gender" required>
                                    <option value="">SeÃ§in...</option>
                                    <option value="M">Erkek</option>
                                    <option value="F">KadÄ±n</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="occupation">Meslek</label>
                                <input type="text" id="occupation" name="occupation">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ä°letiÅŸim Bilgileri -->
                    <div class="form-section">
                        <h3 class="section-title">Ä°letiÅŸim Bilgileri</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="phone">Telefon <span class="required">*</span></label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="email">E-posta</label>
                                <input type="email" id="email" name="email">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">Åžehir</label>
                                <input type="text" id="city" name="city">
                            </div>
                            <div class="form-group">
                                <label for="district">Ä°lÃ§e</label>
                                <input type="text" id="district" name="district">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="address">Adres</label>
                            <textarea id="address" name="address" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <!-- TÄ±bbi Bilgiler -->
                    <div class="form-section">
                        <h3 class="section-title">TÄ±bbi Bilgiler</h3>
                        <div class="form-group">
                            <label for="medicalHistory">TÄ±bbi GeÃ§miÅŸ</label>
                            <textarea id="medicalHistory" name="medical_history" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="allergies">Alerjiler</label>
                            <textarea id="allergies" name="allergies" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="currentMedications">Mevcut Ä°laÃ§lar</label>
                            <textarea id="currentMedications" name="current_medications" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <!-- Acil Durum Bilgileri -->
                    <div class="form-section">
                        <h3 class="section-title">Acil Durum Bilgileri</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="emergencyContact">Acil Durum Ä°letiÅŸim KiÅŸisi</label>
                                <input type="text" id="emergencyContact" name="emergency_contact">
                            </div>
                            <div class="form-group">
                                <label for="emergencyPhone">Acil Durum Telefonu</label>
                                <input type="tel" id="emergencyPhone" name="emergency_phone">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ä°ÅŸitme CihazÄ± Bilgileri -->
                    <div class="form-section">
                        <h3 class="section-title">Ä°ÅŸitme CihazÄ± Bilgileri</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hearingAidType">Ä°ÅŸitme CihazÄ± TÃ¼rÃ¼</label>
                                <select id="hearingAidType" name="hearing_aid_type">
                                    <option value="">SeÃ§in...</option>
                                    <option value="BTE">BTE (Kulak ArkasÄ±)</option>
                                    <option value="ITE">ITE (Kulak Ä°Ã§i)</option>
                                    <option value="ITC">ITC (Kulak KanalÄ±)</option>
                                    <option value="CIC">CIC (Tam Gizli)</option>
                                    <option value="RIC">RIC (Kulak ArkasÄ± AÃ§Ä±k)</option>
                                    <option value="None">KullanmÄ±yor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="hearingAidBrand">Marka</label>
                                <input type="text" id="hearingAidBrand" name="hearing_aid_brand">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hearingAidModel">Model</label>
                                <input type="text" id="hearingAidModel" name="hearing_aid_model">
                            </div>
                            <div class="form-group">
                                <label for="hearingAidSerial">Seri No</label>
                                <input type="text" id="hearingAidSerial" name="hearing_aid_serial">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sosyal Bilgiler -->
                    <div class="form-section">
                        <h3 class="section-title">Sosyal Bilgiler</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="insuranceProvider">Sigorta SaÄŸlayÄ±cÄ±sÄ±</label>
                                <input type="text" id="insuranceProvider" name="insurance_provider">
                            </div>
                            <div class="form-group">
                                <label for="insuranceNumber">Sigorta NumarasÄ±</label>
                                <input type="text" id="insuranceNumber" name="insurance_number">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="referringDoctor">Sevk Eden Doktor</label>
                            <input type="text" id="referringDoctor" name="referring_doctor">
                        </div>
                    </div>
                    
                    <!-- Genel Bilgiler -->
                    <div class="form-section">
                        <h3 class="section-title">Genel Bilgiler</h3>
                        <div class="form-group">
                            <label for="notes">Notlar</label>
                            <textarea id="notes" name="notes" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="status">Durum <span class="required">*</span></label>
                            <select id="status" name="status" required>
                                <option value="">SeÃ§in...</option>
                                <option value="active" selected>Aktif</option>
                                <option value="inactive">Pasif</option>
                            </select>
                        </div>
                    </div>
                   <div class="form-actions">
                       <button type="button" onclick="closeNewPatientModal()" class="btn-secondary">
                           <i class="fa-solid fa-times"></i>
                           Ä°ptal
                       </button>
                       <button type="submit" class="btn-primary">
                           <i class="fa-solid fa-save"></i>
                           Kaydet
                       </button>
                   </div>
               </form>
           </div>
       </div>
   </div>

   <!-- Hasta DÃ¼zenleme Modal -->
   <div id="editPatientModal" class="modal" style="display: none;">
       <div class="modal-content">
           <div class="modal-header">
               <h2><i class="fa-solid fa-edit"></i> Hasta DÃ¼zenle</h2>
               <span class="close" onclick="closeEditPatientModal()">&times;</span>
           </div>
           <div class="modal-body">
               <form id="editPatientForm">
                   {% csrf_token %}
                   <input type="hidden" id="editPatientId" name="patient_id">
                   
                    <!-- Temel Bilgiler -->
                    <div class="form-section">
                        <h3 class="section-title">Temel Bilgiler</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editTcNumber">TC Kimlik No <span class="required">*</span></label>
                                <input type="text" id="editTcNumber" name="tc_number" maxlength="11" required>
                            </div>
                            <div class="form-group">
                                <label for="editFirstName">Ad <span class="required">*</span></label>
                                <input type="text" id="editFirstName" name="first_name" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editLastName">Soyad <span class="required">*</span></label>
                                <input type="text" id="editLastName" name="last_name" required>
                            </div>
                            <div class="form-group">
                                <label for="editBirthDate">DoÄŸum Tarihi <span class="required">*</span></label>
                                <input type="date" id="editBirthDate" name="birth_date" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editGender">Cinsiyet <span class="required">*</span></label>
                                <select id="editGender" name="gender" required>
                                    <option value="">SeÃ§in...</option>
                                    <option value="M">Erkek</option>
                                    <option value="F">KadÄ±n</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editOccupation">Meslek</label>
                                <input type="text" id="editOccupation" name="occupation">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ä°letiÅŸim Bilgileri -->
                    <div class="form-section">
                        <h3 class="section-title">Ä°letiÅŸim Bilgileri</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editPhone">Telefon <span class="required">*</span></label>
                                <input type="tel" id="editPhone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="editEmail">E-posta</label>
                                <input type="email" id="editEmail" name="email">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editCity">Åžehir</label>
                                <input type="text" id="editCity" name="city">
                            </div>
                            <div class="form-group">
                                <label for="editDistrict">Ä°lÃ§e</label>
                                <input type="text" id="editDistrict" name="district">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editAddress">Adres</label>
                            <textarea id="editAddress" name="address" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <!-- TÄ±bbi Bilgiler -->
                    <div class="form-section">
                        <h3 class="section-title">TÄ±bbi Bilgiler</h3>
                        <div class="form-group">
                            <label for="editMedicalHistory">TÄ±bbi GeÃ§miÅŸ</label>
                            <textarea id="editMedicalHistory" name="medical_history" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="editAllergies">Alerjiler</label>
                            <textarea id="editAllergies" name="allergies" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="editCurrentMedications">Mevcut Ä°laÃ§lar</label>
                            <textarea id="editCurrentMedications" name="current_medications" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <!-- Acil Durum Bilgileri -->
                    <div class="form-section">
                        <h3 class="section-title">Acil Durum Bilgileri</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editEmergencyContact">Acil Durum Ä°letiÅŸim KiÅŸisi</label>
                                <input type="text" id="editEmergencyContact" name="emergency_contact">
                            </div>
                            <div class="form-group">
                                <label for="editEmergencyPhone">Acil Durum Telefonu</label>
                                <input type="tel" id="editEmergencyPhone" name="emergency_phone">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ä°ÅŸitme CihazÄ± Bilgileri -->
                    <div class="form-section">
                        <h3 class="section-title">Ä°ÅŸitme CihazÄ± Bilgileri</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editHearingAidType">Ä°ÅŸitme CihazÄ± TÃ¼rÃ¼</label>
                                <select id="editHearingAidType" name="hearing_aid_type">
                                    <option value="">SeÃ§in...</option>
                                    <option value="BTE">BTE (Kulak ArkasÄ±)</option>
                                    <option value="ITE">ITE (Kulak Ä°Ã§i)</option>
                                    <option value="ITC">ITC (Kulak KanalÄ±)</option>
                                    <option value="CIC">CIC (Tam Gizli)</option>
                                    <option value="RIC">RIC (Kulak ArkasÄ± AÃ§Ä±k)</option>
                                    <option value="None">KullanmÄ±yor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editHearingAidBrand">Marka</label>
                                <input type="text" id="editHearingAidBrand" name="hearing_aid_brand">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editHearingAidModel">Model</label>
                                <input type="text" id="editHearingAidModel" name="hearing_aid_model">
                            </div>
                            <div class="form-group">
                                <label for="editHearingAidSerial">Seri No</label>
                                <input type="text" id="editHearingAidSerial" name="hearing_aid_serial">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sosyal Bilgiler -->
                    <div class="form-section">
                        <h3 class="section-title">Sosyal Bilgiler</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editInsuranceProvider">Sigorta SaÄŸlayÄ±cÄ±sÄ±</label>
                                <input type="text" id="editInsuranceProvider" name="insurance_provider">
                            </div>
                            <div class="form-group">
                                <label for="editInsuranceNumber">Sigorta NumarasÄ±</label>
                                <input type="text" id="editInsuranceNumber" name="insurance_number">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editReferringDoctor">Sevk Eden Doktor</label>
                            <input type="text" id="editReferringDoctor" name="referring_doctor">
                        </div>
                    </div>
                    
                    <!-- Genel Bilgiler -->
                    <div class="form-section">
                        <h3 class="section-title">Genel Bilgiler</h3>
                        <div class="form-group">
                            <label for="editNotes">Notlar</label>
                            <textarea id="editNotes" name="notes" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="editStatus">Durum <span class="required">*</span></label>
                            <select id="editStatus" name="status" required>
                                <option value="">SeÃ§in...</option>
                                <option value="active">Aktif</option>
                                <option value="inactive">Pasif</option>
                            </select>
                        </div>
                    </div>
                   
                   <div class="form-actions">
                       <button type="button" onclick="closeEditPatientModal()" class="btn-secondary">Ä°ptal</button>
                       <button type="submit" class="btn-primary">GÃ¼ncelle</button>
                   </div>
               </form>
           </div>
       </div>
   </div>
